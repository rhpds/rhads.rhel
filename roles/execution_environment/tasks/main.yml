---
- name: Pull images for student
  become: true
  become_user: "{{ rhads_rhel_execution_environment_host_user }}"
  block:
    - name: Login to registry if private registry is configured
      containers.podman.podman_login:
        registry: "{{ rhads_rhel_execution_environment_registry_url }}"
        username: "{{ rhads_rhel_execution_environment_registry_username }}"
        password: "{{ rhads_rhel_execution_environment_registry_password }}"
      when:
        - rhads_rhel_execution_environment_registry_url is defined
        - rhads_rhel_execution_environment_registry_username is defined
        - rhads_rhel_execution_environment_registry_password is defined
      no_log: true

    - name: Pull execution environment image from quay.io
      containers.podman.podman_image:
        name: "{{ rhads_rhel_execution_environment_image_name }}:{{ rhads_rhel_execution_environment_image_tag }}"
        pull: true
        state: present
      register: _r_pull_result

    - name: Retag the downloaded ee image
      containers.podman.podman_image:
        name: "{{ rhads_rhel_execution_environment_image_name }}:{{ rhads_rhel_execution_environment_image_tag }}"
        tag: "{{ rhads_rhel_execution_environment_image_retag }}"
        state: present
      when:
        - _r_pull_result is succeeded
        - rhads_rhel_execution_environment_image_retag is defined

    - name: Display pull results
      debug:
        msg: "Successfully downloaded execution environment: {{ rhads_rhel_execution_environment_image_name }}" 
      when: _r_pull_result is succeeded

